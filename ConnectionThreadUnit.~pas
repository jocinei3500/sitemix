unit ConnectionThreadUnit;

interface

uses
  Classes, IdModBusClient, SysUtils;

type
  TConnectionThread = class(TThread)
  private
    FIpAddress: string;
    FModbusClient: TIdModBusClient;
    FSuccess: Boolean;
  protected
    procedure Execute; override;
  public
    constructor Create(const IpAddress: string); reintroduce;
    destructor Destroy; override;
    property Success: Boolean read FSuccess;
  end;

implementation

constructor TConnectionThread.Create(const IpAddress: string);
begin
  inherited Create(True); // Create suspended
  FIpAddress := IpAddress;
  FreeOnTerminate := True;
  FSuccess := False;
end;

destructor TConnectionThread.Destroy;
begin
  FModbusClient.Free;
  inherited;
end;

procedure TConnectionThread.Execute;
begin
  FModbusClient := TIdModBusClient.Create(nil);
  try
    FModbusClient.Host := FIpAddress;
    try
      FModbusClient.Connect;
      FSuccess := FModbusClient.Connected;
    except
      FSuccess := False;
    end;
  finally
    FModbusClient.Free;
  end;
end;

end.

